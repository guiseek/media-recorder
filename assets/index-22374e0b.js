var Pt=Object.defineProperty;var Ft=(e,t,r)=>t in e?Pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var le=(e,t,r)=>(Ft(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();function Lt(e){const t=document.createElement("meta");t.httpEquiv="origin-trial",t.content=e,document.head.appendChild(t)}function Ye(){return["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=h264,opus","video/mp4;codecs=h264,aac"].filter(t=>MediaRecorder.isTypeSupported(t))}function _t(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var o=[null];o.push.apply(o,arguments);var i=Function.bind.apply(t,o);return new i}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),r}var Ge={},At={get exports(){return Ge},set exports(e){Ge=e}};(function(e){var t=function(r){var n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(c,a,d){c[a]=d.value},s,u=typeof Symbol=="function"?Symbol:{},l=u.iterator||"@@iterator",f=u.asyncIterator||"@@asyncIterator",v=u.toStringTag||"@@toStringTag";function b(c,a,d){return Object.defineProperty(c,a,{value:d,enumerable:!0,configurable:!0,writable:!0}),c[a]}try{b({},"")}catch{b=function(a,d,y){return a[d]=y}}function g(c,a,d,y){var h=a&&a.prototype instanceof H?a:H,S=Object.create(h.prototype),T=new L(y||[]);return i(S,"_invoke",{value:Oe(c,d,T)}),S}r.wrap=g;function w(c,a,d){try{return{type:"normal",arg:c.call(a,d)}}catch(y){return{type:"throw",arg:y}}}var A="suspendedStart",O="suspendedYield",$="executing",U="completed",P={};function H(){}function X(){}function W(){}var ae={};b(ae,l,function(){return this});var ce=Object.getPrototypeOf,K=ce&&ce(ce(_([])));K&&K!==n&&o.call(K,l)&&(ae=K);var N=W.prototype=H.prototype=Object.create(ae);X.prototype=W,i(N,"constructor",{value:W,configurable:!0}),i(W,"constructor",{value:X,configurable:!0}),X.displayName=b(W,v,"GeneratorFunction");function pe(c){["next","throw","return"].forEach(function(a){b(c,a,function(d){return this._invoke(a,d)})})}r.isGeneratorFunction=function(c){var a=typeof c=="function"&&c.constructor;return a?a===X||(a.displayName||a.name)==="GeneratorFunction":!1},r.mark=function(c){return Object.setPrototypeOf?Object.setPrototypeOf(c,W):(c.__proto__=W,b(c,v,"GeneratorFunction")),c.prototype=Object.create(N),c},r.awrap=function(c){return{__await:c}};function Q(c,a){function d(S,T,x,M){var R=w(c[S],c,T);if(R.type==="throw")M(R.arg);else{var Pe=R.arg,ue=Pe.value;return ue&&typeof ue=="object"&&o.call(ue,"__await")?a.resolve(ue.__await).then(function(Z){d("next",Z,x,M)},function(Z){d("throw",Z,x,M)}):a.resolve(ue).then(function(Z){Pe.value=Z,x(Pe)},function(Z){return d("throw",Z,x,M)})}}var y;function h(S,T){function x(){return new a(function(M,R){d(S,T,M,R)})}return y=y?y.then(x,x):x()}i(this,"_invoke",{value:h})}pe(Q.prototype),b(Q.prototype,f,function(){return this}),r.AsyncIterator=Q,r.async=function(c,a,d,y,h){h===void 0&&(h=Promise);var S=new Q(g(c,a,d,y),h);return r.isGeneratorFunction(a)?S:S.next().then(function(T){return T.done?T.value:S.next()})};function Oe(c,a,d){var y=A;return function(S,T){if(y===$)throw new Error("Generator is already running");if(y===U){if(S==="throw")throw T;return I()}for(d.method=S,d.arg=T;;){var x=d.delegate;if(x){var M=he(x,d);if(M){if(M===P)continue;return M}}if(d.method==="next")d.sent=d._sent=d.arg;else if(d.method==="throw"){if(y===A)throw y=U,d.arg;d.dispatchException(d.arg)}else d.method==="return"&&d.abrupt("return",d.arg);y=$;var R=w(c,a,d);if(R.type==="normal"){if(y=d.done?U:O,R.arg===P)continue;return{value:R.arg,done:d.done}}else R.type==="throw"&&(y=U,d.method="throw",d.arg=R.arg)}}}function he(c,a){var d=a.method,y=c.iterator[d];if(y===s)return a.delegate=null,d==="throw"&&c.iterator.return&&(a.method="return",a.arg=s,he(c,a),a.method==="throw")||d!=="return"&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+d+"' method")),P;var h=w(y,c.iterator,a.arg);if(h.type==="throw")return a.method="throw",a.arg=h.arg,a.delegate=null,P;var S=h.arg;if(!S)return a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,P;if(S.done)a[c.resultName]=S.value,a.next=c.nextLoc,a.method!=="return"&&(a.method="next",a.arg=s);else return S;return a.delegate=null,P}pe(N),b(N,v,"Generator"),b(N,l,function(){return this}),b(N,"toString",function(){return"[object Generator]"});function m(c){var a={tryLoc:c[0]};1 in c&&(a.catchLoc=c[1]),2 in c&&(a.finallyLoc=c[2],a.afterLoc=c[3]),this.tryEntries.push(a)}function F(c){var a=c.completion||{};a.type="normal",delete a.arg,c.completion=a}function L(c){this.tryEntries=[{tryLoc:"root"}],c.forEach(m,this),this.reset(!0)}r.keys=function(c){var a=Object(c),d=[];for(var y in a)d.push(y);return d.reverse(),function h(){for(;d.length;){var S=d.pop();if(S in a)return h.value=S,h.done=!1,h}return h.done=!0,h}};function _(c){if(c){var a=c[l];if(a)return a.call(c);if(typeof c.next=="function")return c;if(!isNaN(c.length)){var d=-1,y=function h(){for(;++d<c.length;)if(o.call(c,d))return h.value=c[d],h.done=!1,h;return h.value=s,h.done=!0,h};return y.next=y}}return{next:I}}r.values=_;function I(){return{value:s,done:!0}}return L.prototype={constructor:L,reset:function(c){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(F),!c)for(var a in this)a.charAt(0)==="t"&&o.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=s)},stop:function(){this.done=!0;var c=this.tryEntries[0],a=c.completion;if(a.type==="throw")throw a.arg;return this.rval},dispatchException:function(c){if(this.done)throw c;var a=this;function d(M,R){return S.type="throw",S.arg=c,a.next=M,R&&(a.method="next",a.arg=s),!!R}for(var y=this.tryEntries.length-1;y>=0;--y){var h=this.tryEntries[y],S=h.completion;if(h.tryLoc==="root")return d("end");if(h.tryLoc<=this.prev){var T=o.call(h,"catchLoc"),x=o.call(h,"finallyLoc");if(T&&x){if(this.prev<h.catchLoc)return d(h.catchLoc,!0);if(this.prev<h.finallyLoc)return d(h.finallyLoc)}else if(T){if(this.prev<h.catchLoc)return d(h.catchLoc,!0)}else if(x){if(this.prev<h.finallyLoc)return d(h.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(c,a){for(var d=this.tryEntries.length-1;d>=0;--d){var y=this.tryEntries[d];if(y.tryLoc<=this.prev&&o.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var h=y;break}}h&&(c==="break"||c==="continue")&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var S=h?h.completion:{};return S.type=c,S.arg=a,h?(this.method="next",this.next=h.finallyLoc,P):this.complete(S)},complete:function(c,a){if(c.type==="throw")throw c.arg;return c.type==="break"||c.type==="continue"?this.next=c.arg:c.type==="return"?(this.rval=this.arg=c.arg,this.method="return",this.next="end"):c.type==="normal"&&a&&(this.next=a),P},finish:function(c){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===c)return this.complete(d.completion,d.afterLoc),F(d),P}},catch:function(c){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===c){var y=d.completion;if(y.type==="throw"){var h=y.arg;F(d)}return h}}throw new Error("illegal catch attempt")},delegateYield:function(c,a,d){return this.delegate={iterator:_(c),resultName:a,nextLoc:d},this.method==="next"&&(this.arg=s),P}},r}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(At);var jt={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}},kt=(e,t)=>{const r=e._malloc(t.length*Uint32Array.BYTES_PER_ELEMENT);return t.forEach((n,o)=>{const i=e.lengthBytesUTF8(n)+1,s=e._malloc(i);e.stringToUTF8(n,s,i),e.setValue(r+Uint32Array.BYTES_PER_ELEMENT*o,s,"i32")}),[t.length,r]};const It="@ffmpeg/ffmpeg",Tt="0.11.6",xt="FFmpeg WebAssembly version",Rt="src/index.js",Ct="src/index.d.ts",Ut={example:"examples"},Mt={start:"node scripts/server.js","start:worker":"node scripts/worker-server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js","build:worker":"rimraf dist && webpack --config scripts/webpack.config.worker.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node node_modules/mocha/bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Gt={"./src/node/index.js":"./src/browser/index.js"},$t={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},Wt=["ffmpeg","WebAssembly","video"],Bt="Jerome Wu <jeromewus@gmail.com>",Dt="MIT",Jt={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},Nt={node:">=12.16.1"},Zt="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Vt={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},qt={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.11.0","@types/emscripten":"^1.39.4","babel-eslint":"^10.1.0","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"},Yt="https://registry.npmjs.org/@ffmpeg/ffmpeg/-/ffmpeg-0.11.6.tgz",zt="sha512-uN8J8KDjADEavPhNva6tYO9Fj0lWs9z82swF3YXnTxWMBoFLGq3LZ6FLlIldRKEzhOBKnkVfA8UnFJuvGvNxcA==",Ht="@ffmpeg/ffmpeg@0.11.6",ze={name:It,version:Tt,description:xt,main:Rt,types:Ct,directories:Ut,scripts:Mt,browser:Gt,repository:$t,keywords:Wt,author:Bt,license:Dt,bugs:Jt,engines:Nt,homepage:Zt,dependencies:Vt,devDependencies:qt,_resolved:Yt,_integrity:zt,_from:Ht},Xt=(typeof process<"u",`https://unpkg.com/@ffmpeg/core@${ze.devDependencies["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`),Kt={corePath:Xt};let Te=!1,He=()=>{};const Qt=e=>{Te=e},er=e=>{He=e},tr=(e,t)=>{He({type:e,message:t}),Te&&console.log(`[${e}] ${t}`)};var q={logging:Te,setLogging:Qt,setCustomLogger:er,log:tr};const rr=e=>`
createFFmpegCore is not defined. ffmpeg.wasm is unable to find createFFmpegCore after loading ffmpeg-core.js from ${e}. Use another URL when calling createFFmpeg():

const ffmpeg = createFFmpeg({
  corePath: 'http://localhost:3000/ffmpeg-core.js',
});
`;var $e={CREATE_FFMPEG_CORE_IS_NOT_DEFINED:rr};const ee=async(e,t)=>{q.log("info",`fetch ${e}`);const r=await(await fetch(e)).arrayBuffer();q.log("info",`${e} file size = ${r.byteLength} bytes`);const n=new Blob([r],{type:t}),o=URL.createObjectURL(n);return q.log("info",`${e} blob URL = ${o}`),o},nr=async({corePath:e,workerPath:t,wasmPath:r})=>{if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){if(typeof e!="string")throw Error("corePath should be a string!");const u=new URL(e,import.meta.url).href,l=await ee(u,"application/javascript"),f=await ee(r!==void 0?r:u.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),v=await ee(t!==void 0?t:u.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(b=>{if(globalThis.importScripts(l),typeof createFFmpegCore>"u")throw Error($e.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(u));q.log("info","ffmpeg-core.js script loaded"),b({createFFmpegCore,corePath:l,wasmPath:f,workerPath:v})}):(q.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:l,wasmPath:f,workerPath:v}))}if(typeof e!="string")throw Error("corePath should be a string!");const n=new URL(e,import.meta.url).href,o=await ee(n,"application/javascript"),i=await ee(r!==void 0?r:n.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),s=await ee(t!==void 0?t:n.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(u=>{const l=document.createElement("script"),f=()=>{if(l.removeEventListener("load",f),typeof createFFmpegCore>"u")throw Error($e.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(n));q.log("info","ffmpeg-core.js script loaded"),u({createFFmpegCore,corePath:o,wasmPath:i,workerPath:s})};l.src=o,l.type="text/javascript",l.addEventListener("load",f),document.getElementsByTagName("head")[0].appendChild(l)}):(q.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:o,wasmPath:i,workerPath:s}))},or=e=>new Promise((t,r)=>{const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=({target:{error:{code:o}}})=>{r(Error(`File could not be read! Code=${o}`))},n.readAsArrayBuffer(e)}),ir=async e=>{let t=e;return typeof e>"u"?new Uint8Array:(typeof e=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(r=>r.charCodeAt(0)):t=await(await fetch(new URL(e,import.meta.url).href)).arrayBuffer():(e instanceof File||e instanceof Blob)&&(t=await or(e)),new Uint8Array(t))},sr=Object.freeze(Object.defineProperty({__proto__:null,defaultOptions:Kt,fetchFile:ir,getCreateFFmpegCore:nr},Symbol.toStringTag,{value:"Module"})),Xe=_t(sr),{defaultArgs:ar,baseOptions:cr}=jt,ur=kt,{defaultOptions:lr,getCreateFFmpegCore:fr}=Xe,{version:dr}=ze,Fe=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var pr=(e={})=>{const{log:t,logger:r,progress:n,...o}={...cr,...lr,...e};let i=null,s=null,u=null,l=null,f=!1,v=()=>{},b=t,g=n,w=0,A=0,O=!1,$=0;const U=m=>{m==="FFMPEG_END"&&u!==null&&(u(),u=null,l=null,f=!1)},P=(m,F)=>{v({type:m,message:F}),b&&console.log(`[${m}] ${F}`)},H=m=>{const[F,L,_]=m.split(":");return parseFloat(F)*60*60+parseFloat(L)*60+parseFloat(_)},X=(m,F)=>{if(typeof m=="string")if(m.startsWith("  Duration")){const L=m.split(", ")[0].split(": ")[1],_=H(L);F({duration:_,ratio:$}),(w===0||w>_)&&(w=_,O=!0)}else if(O&&m.startsWith("    Stream")){const L=m.match(/([\d.]+) fps/);if(L){const _=parseFloat(L[1]);A=w*_}else A=0;O=!1}else if(m.startsWith("frame")||m.startsWith("size")){const L=m.split("time=")[1].split(" ")[0],_=H(L),I=m.match(/frame=\s*(\d+)/);if(A&&I){const c=parseFloat(I[1]);$=Math.min(c/A,1)}else $=_/w;F({ratio:$,time:_})}else m.startsWith("video:")&&(F({ratio:1}),w=0)},W=({type:m,message:F})=>{P(m,F),X(F,g),U(F)},ae=async()=>{if(P("info","load ffmpeg-core"),i===null){P("info","loading ffmpeg-core");const{createFFmpegCore:m,corePath:F,workerPath:L,wasmPath:_}=await fr(o);i=await m({mainScriptUrlOrBlob:F,printErr:I=>W({type:"fferr",message:I}),print:I=>W({type:"ffout",message:I}),locateFile:(I,c)=>{if(typeof window<"u"||typeof WorkerGlobalScope<"u"){if(typeof _<"u"&&I.endsWith("ffmpeg-core.wasm"))return _;if(typeof L<"u"&&I.endsWith("ffmpeg-core.worker.js"))return L}return c+I}}),s=i.cwrap(o.mainName||"proxy_main","number",["number","number"]),P("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},ce=()=>i!==null,K=(...m)=>{if(P("info",`run ffmpeg command: ${m.join(" ")}`),i===null)throw Fe;if(f)throw Error("ffmpeg.wasm can only run one command at a time");return f=!0,new Promise((F,L)=>{const _=[...ar,...m].filter(I=>I.length!==0);u=F,l=L,s(...ur(i,_))})},N=(m,...F)=>{if(P("info",`run FS.${m} ${F.map(L=>typeof L=="string"?L:`<${L.length} bytes binary file>`).join(" ")}`),i===null)throw Fe;{let L=null;try{L=i.FS[m](...F)}catch{throw Error(m==="readdir"?`ffmpeg.FS('readdir', '${F[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:m==="readFile"?`ffmpeg.FS('readFile', '${F[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return L}},pe=()=>{if(i===null)throw Fe;l&&l("ffmpeg has exited"),f=!1;try{i.exit(1)}catch(m){P(m.message),l&&l(m)}finally{i=null,s=null,u=null,l=null}},Q=m=>{g=m},Oe=m=>{v=m},he=m=>{b=m};return P("info",`use ffmpeg.wasm v${dr}`),{setProgress:Q,setLogger:Oe,setLogging:he,load:ae,isLoaded:ce,run:K,exit:pe,FS:N}};const hr=pr,{fetchFile:vr}=Xe;var Ke={createFFmpeg:hr,fetchFile:vr};const mr=e=>({time:t,ratio:r},n)=>{let o=0,i=0;t&&(i=100*t/n),r===1&&(i=100),i>o&&e(i),o=i};var Ae=function(e,t){return Ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},Ae(e,t)};function oe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Ae(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function yr(e,t,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function u(v){try{f(n.next(v))}catch(b){s(b)}}function l(v){try{f(n.throw(v))}catch(b){s(b)}}function f(v){v.done?i(v.value):o(v.value).then(u,l)}f((n=n.apply(e,t||[])).next())})}function Qe(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(f){return function(v){return l([f,v])}}function l(f){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,f[0]&&(r=0)),r;)try{if(n=1,o&&(i=f[0]&2?o.return:f[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,f[1])).done)return i;switch(o=0,i&&(f=[f[0]&2,i.value]),f[0]){case 0:case 1:i=f;break;case 4:return r.label++,{value:f[1],done:!1};case 5:r.label++,o=f[1],f=[0];continue;case 7:f=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){r=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){r.label=f[1];break}if(f[0]===6&&r.label<i[1]){r.label=i[1],i=f;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(f);break}i[2]&&r.ops.pop(),r.trys.pop();continue}f=t.call(e,r)}catch(v){f=[6,v],o=0}finally{n=i=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function re(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ne(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],s;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(u){s={error:u}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function de(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function te(e){return this instanceof te?(this.v=e,this):new te(e)}function gr(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(g){n[g]&&(o[g]=function(w){return new Promise(function(A,O){i.push([g,w,A,O])>1||u(g,w)})})}function u(g,w){try{l(n[g](w))}catch(A){b(i[0][3],A)}}function l(g){g.value instanceof te?Promise.resolve(g.value.v).then(f,v):b(i[0][2],g)}function f(g){u("next",g)}function v(g){u("throw",g)}function b(g,w){g(w),i.shift(),i.length&&u(i[0][0],i[0][1])}}function br(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof re=="function"?re(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(s){return new Promise(function(u,l){s=e[i](s),o(u,l,s.done,s.value)})}}function o(i,s,u,l){Promise.resolve(l).then(function(f){i({value:f,done:u})},s)}}function E(e){return typeof e=="function"}function et(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Le=et(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function je(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var we=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var u=re(s),l=u.next();!l.done;l=u.next()){var f=l.value;f.remove(this)}}catch(O){t={error:O}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}else s.remove(this);var v=this.initialTeardown;if(E(v))try{v()}catch(O){i=O instanceof Le?O.errors:[O]}var b=this._finalizers;if(b){this._finalizers=null;try{for(var g=re(b),w=g.next();!w.done;w=g.next()){var A=w.value;try{We(A)}catch(O){i=i??[],O instanceof Le?i=de(de([],ne(i)),ne(O.errors)):i.push(O)}}}catch(O){n={error:O}}finally{try{w&&!w.done&&(o=g.return)&&o.call(g)}finally{if(n)throw n.error}}}if(i)throw new Le(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)We(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&je(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&je(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),tt=we.EMPTY;function rt(e){return e instanceof we||e&&"closed"in e&&E(e.remove)&&E(e.add)&&E(e.unsubscribe)}function We(e){E(e)?e():e.unsubscribe()}var nt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ke={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=ke.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,de([e,t],ne(r))):setTimeout.apply(void 0,de([e,t],ne(r)))},clearTimeout:function(e){var t=ke.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ot(e){ke.setTimeout(function(){throw e})}function Be(){}function me(e){e()}var xe=function(e){oe(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,rt(r)&&r.add(n)):n.destination=Or,n}return t.create=function(r,n,o){return new Ie(r,n,o)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(we),wr=Function.prototype.bind;function _e(e,t){return wr.call(e,t)}var Sr=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){ve(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){ve(n)}else ve(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){ve(r)}},e}(),Ie=function(e){oe(t,e);function t(r,n,o){var i=e.call(this)||this,s;if(E(r)||!r)s={next:r??void 0,error:n??void 0,complete:o??void 0};else{var u;i&&nt.useDeprecatedNextContext?(u=Object.create(r),u.unsubscribe=function(){return i.unsubscribe()},s={next:r.next&&_e(r.next,u),error:r.error&&_e(r.error,u),complete:r.complete&&_e(r.complete,u)}):s=r}return i.destination=new Sr(s),i}return t}(xe);function ve(e){ot(e)}function Er(e){throw e}var Or={closed:!0,next:Be,error:Er,complete:Be},Re=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Se(e){return e}function Pr(e){return e.length===0?Se:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var C=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,i=Lr(t)?t:new Ie(t,r,n);return me(function(){var s=o,u=s.operator,l=s.source;i.add(u?u.call(i,l):l?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=De(r),new r(function(o,i){var s=new Ie({next:function(u){try{t(u)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});n.subscribe(s)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[Re]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Pr(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=De(t),new t(function(n,o){var i;r.subscribe(function(s){return i=s},function(s){return o(s)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function De(e){var t;return(t=e??nt.Promise)!==null&&t!==void 0?t:Promise}function Fr(e){return e&&E(e.next)&&E(e.error)&&E(e.complete)}function Lr(e){return e&&e instanceof xe||Fr(e)&&rt(e)}function _r(e){return E(e==null?void 0:e.lift)}function ie(e){return function(t){if(_r(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function z(e,t,r,n,o){return new Ar(e,t,r,n,o)}var Ar=function(e){oe(t,e);function t(r,n,o,i,s,u){var l=e.call(this,r)||this;return l.onFinalize=s,l.shouldUnsubscribe=u,l._next=n?function(f){try{n(f)}catch(v){r.error(v)}}:e.prototype._next,l._error=i?function(f){try{i(f)}catch(v){r.error(v)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=o?function(){try{o()}catch(f){r.error(f)}finally{this.unsubscribe()}}:e.prototype._complete,l}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(xe),jr=et(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),it=function(e){oe(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new Je(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new jr},t.prototype.next=function(r){var n=this;me(function(){var o,i;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=re(n.currentObservers),u=s.next();!u.done;u=s.next()){var l=u.value;l.next(r)}}catch(f){o={error:f}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},t.prototype.error=function(r){var n=this;me(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var o=n.observers;o.length;)o.shift().error(r)}})},t.prototype.complete=function(){var r=this;me(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,o=this,i=o.hasError,s=o.isStopped,u=o.observers;return i||s?tt:(this.currentObservers=null,u.push(r),new we(function(){n.currentObservers=null,je(u,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,o=n.hasError,i=n.thrownError,s=n.isStopped;o?r.error(i):s&&r.complete()},t.prototype.asObservable=function(){var r=new C;return r.source=this,r},t.create=function(r,n){return new Je(r,n)},t}(C),Je=function(e){oe(t,e);function t(r,n){var o=e.call(this)||this;return o.destination=r,o.source=n,o}return t.prototype.next=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,r)},t.prototype.error=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&o!==void 0?o:tt},t}(it),st=function(e){oe(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,o=r.thrownError,i=r._value;if(n)throw o;return this._throwIfClosed(),i},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(it);function kr(e){return e&&E(e.schedule)}function at(e){return e[e.length-1]}function Ir(e){return E(at(e))?e.pop():void 0}function Tr(e){return kr(at(e))?e.pop():void 0}var Ce=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function ct(e){return E(e==null?void 0:e.then)}function ut(e){return E(e[Re])}function lt(e){return Symbol.asyncIterator&&E(e==null?void 0:e[Symbol.asyncIterator])}function ft(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function xr(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var dt=xr();function pt(e){return E(e==null?void 0:e[dt])}function ht(e){return gr(this,arguments,function(){var r,n,o,i;return Qe(this,function(s){switch(s.label){case 0:r=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,te(r.read())];case 3:return n=s.sent(),o=n.value,i=n.done,i?[4,te(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,te(o)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function vt(e){return E(e==null?void 0:e.getReader)}function se(e){if(e instanceof C)return e;if(e!=null){if(ut(e))return Rr(e);if(Ce(e))return Cr(e);if(ct(e))return Ur(e);if(lt(e))return mt(e);if(pt(e))return Mr(e);if(vt(e))return Gr(e)}throw ft(e)}function Rr(e){return new C(function(t){var r=e[Re]();if(E(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Cr(e){return new C(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function Ur(e){return new C(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,ot)})}function Mr(e){return new C(function(t){var r,n;try{for(var o=re(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(u){r={error:u}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}t.complete()})}function mt(e){return new C(function(t){$r(e,t).catch(function(r){return t.error(r)})})}function Gr(e){return mt(ht(e))}function $r(e,t){var r,n,o,i;return yr(this,void 0,void 0,function(){var s,u;return Qe(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=br(e),l.label=1;case 1:return[4,r.next()];case 2:if(n=l.sent(),!!n.done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=l.sent(),o={error:u},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function J(e,t,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function yt(e,t){return t===void 0&&(t=0),ie(function(r,n){r.subscribe(z(n,function(o){return J(n,e,function(){return n.next(o)},t)},function(){return J(n,e,function(){return n.complete()},t)},function(o){return J(n,e,function(){return n.error(o)},t)}))})}function gt(e,t){return t===void 0&&(t=0),ie(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function Wr(e,t){return se(e).pipe(gt(t),yt(t))}function Br(e,t){return se(e).pipe(gt(t),yt(t))}function Dr(e,t){return new C(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function Jr(e,t){return new C(function(r){var n;return J(r,t,function(){n=e[dt](),J(r,t,function(){var o,i,s;try{o=n.next(),i=o.value,s=o.done}catch(u){r.error(u);return}s?r.complete():r.next(i)},0,!0)}),function(){return E(n==null?void 0:n.return)&&n.return()}})}function bt(e,t){if(!e)throw new Error("Iterable cannot be null");return new C(function(r){J(r,t,function(){var n=e[Symbol.asyncIterator]();J(r,t,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function Nr(e,t){return bt(ht(e),t)}function Zr(e,t){if(e!=null){if(ut(e))return Wr(e,t);if(Ce(e))return Dr(e,t);if(ct(e))return Br(e,t);if(lt(e))return bt(e,t);if(pt(e))return Jr(e,t);if(vt(e))return Nr(e,t)}throw ft(e)}function wt(e,t){return t?Zr(e,t):se(e)}function Ee(e,t){return ie(function(r,n){var o=0;r.subscribe(z(n,function(i){n.next(e.call(t,i,o++))}))})}var Vr=Array.isArray;function qr(e,t){return Vr(t)?e.apply(void 0,de([],ne(t))):e(t)}function St(e){return Ee(function(t){return qr(e,t)})}var Yr=Array.isArray,zr=Object.getPrototypeOf,Hr=Object.prototype,Xr=Object.keys;function Kr(e){if(e.length===1){var t=e[0];if(Yr(t))return{args:t,keys:null};if(Qr(t)){var r=Xr(t);return{args:r.map(function(n){return t[n]}),keys:r}}}return{args:e,keys:null}}function Qr(e){return e&&typeof e=="object"&&zr(e)===Hr}function en(e,t){return e.reduce(function(r,n,o){return r[n]=t[o],r},{})}function tn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Tr(e),n=Ir(e),o=Kr(e),i=o.args,s=o.keys;if(i.length===0)return wt([],r);var u=new C(rn(i,r,s?function(l){return en(s,l)}:Se));return n?u.pipe(St(n)):u}function rn(e,t,r){return r===void 0&&(r=Se),function(n){Ne(t,function(){for(var o=e.length,i=new Array(o),s=o,u=o,l=function(v){Ne(t,function(){var b=wt(e[v],t),g=!1;b.subscribe(z(n,function(w){i[v]=w,g||(g=!0,u--),u||n.next(r(i.slice()))},function(){--s||n.complete()}))},n)},f=0;f<o;f++)l(f)},n)}}function Ne(e,t,r){e?J(r,e,t):t()}function nn(e,t,r,n,o,i,s,u){var l=[],f=0,v=0,b=!1,g=function(){b&&!l.length&&!f&&t.complete()},w=function(O){return f<n?A(O):l.push(O)},A=function(O){i&&t.next(O),f++;var $=!1;se(r(O,v++)).subscribe(z(t,function(U){o==null||o(U),i?w(U):t.next(U)},function(){$=!0},void 0,function(){if($)try{f--;for(var U=function(){var P=l.shift();s?J(t,s,function(){return A(P)}):A(P)};l.length&&f<n;)U();g()}catch(P){t.error(P)}}))};return e.subscribe(z(t,w,function(){b=!0,g()})),function(){u==null||u()}}function Et(e,t,r){return r===void 0&&(r=1/0),E(t)?Et(function(n,o){return Ee(function(i,s){return t(n,i,o,s)})(se(e(n,o)))},r):(typeof t=="number"&&(r=t),ie(function(n,o){return nn(n,o,e,r)}))}var on=["addListener","removeListener"],sn=["addEventListener","removeEventListener"],an=["on","off"];function B(e,t,r,n){if(E(r)&&(n=r,r=void 0),n)return B(e,t,r).pipe(St(n));var o=ne(ln(e)?sn.map(function(u){return function(l){return e[u](t,l,r)}}):cn(e)?on.map(Ze(e,t)):un(e)?an.map(Ze(e,t)):[],2),i=o[0],s=o[1];if(!i&&Ce(e))return Et(function(u){return B(u,t,r)})(se(e));if(!i)throw new TypeError("Invalid event target");return new C(function(u){var l=function(){for(var f=[],v=0;v<arguments.length;v++)f[v]=arguments[v];return u.next(1<f.length?f:f[0])};return i(l),function(){return s(l)}})}function Ze(e,t){return function(r){return function(n){return e[r](t,n)}}}function cn(e){return E(e.addListener)&&E(e.removeListener)}function un(e){return E(e.on)&&E(e.off)}function ln(e){return E(e.addEventListener)&&E(e.removeEventListener)}function fn(e,t){return ie(function(r,n){var o=0;r.subscribe(z(n,function(i){return e.call(t,i,o++)&&n.next(i)}))})}function dn(e,t){return t===void 0&&(t=Se),e=e??pn,ie(function(r,n){var o,i=!0;r.subscribe(z(n,function(s){var u=t(s);(i||!e(o,u))&&(i=!1,o=u,n.next(s))}))})}function pn(e,t){return e===t}const Ue=(e,t)=>{e.querySelector("summary").ariaDisabled=JSON.stringify(t),e.querySelector("a#download").ariaDisabled=JSON.stringify(t),e.querySelector("a#convert").ariaDisabled=JSON.stringify(t)},hn=e=>(t,r="")=>{console.error(t),e.innerHTML=r?`${r}: `:""+JSON.stringify(t)},vn=[{title:"Fóton gêmeo",description:"Abrindo outra janela e ativando a opção fóton gêmeo, a nova janela terá os controles desabilitados e se tornará um zumbi, repetindo todos os comandos executados na primeira janela, simultaneamente."}];function mn(...e){const t=r=>!!e.find(n=>r instanceof n);return r=>r.pipe(fn(t))}const yn=e=>navigator.mediaDevices.getDisplayMedia({...e,audio:!0});class gn{constructor(t){le(this,"channel");le(this,"_messages",new st(null));le(this,"messages$",this._messages.asObservable());le(this,"_on",[]);this.name=t,this.channel=new BroadcastChannel("signaling"),this.channel.onmessage=({data:r})=>{this._messages.next(r.payload),this._on.forEach(n=>{this.isMe(r.name)||n(r.payload)})}}set on(t){this._on=[...this._on,t]}send(t){this.channel.postMessage({name:this.name,payload:t})}isMe(t){return this.name===t}}const bn=e=>{const t=new st(e),r=()=>t.getValue();return{$:t.asObservable(),select:s=>t.asObservable().pipe(Ee(u=>s(u)),dn()),value:r,setState:s=>{t.next({...r(),...s})}}},Ve=(e,t,r)=>{const n=URL.createObjectURL(e),o=document.createElement("a");o.download=r||t,o.style.display="none",o.href=n,document.body.appendChild(o),o.click(),queueMicrotask(()=>{document.body.removeChild(o),URL.revokeObjectURL(n)})},wn=e=>navigator.mediaDevices.getUserMedia(e),j=e=>document.querySelector(e);Lt("AgGCRMVCOR54hO460bCxLZyB3DLvo2RTPBU74pUnbJO1lWwneVoXsgH/aWM1bvwyU4HoSF7bnh9cPGm+LHiLfQsAAAB7eyJvcmlnaW4iOiJodHRwczovL2d1aXNlZWsuZ2l0aHViLmlvOjQ0MyIsImZlYXR1cmUiOiJVbnJlc3RyaWN0ZWRTaGFyZWRBcnJheUJ1ZmZlciIsImV4cGlyeSI6MTY4ODA4MzE5OSwiaXNTdWJkb21haW4iOnRydWV9");const k=bn({hasOffer:!1,hasAnswer:!1,twinPhoton:!1,iAmZombie:!1,deviceId:"default",codecPreferences:"",source:"user"});let be,V,Y=[];const ye=j("dialog#progress"),fe=Ke.createFFmpeg({log:!1,progress:e=>{mr(t=>{ye.querySelector("progress").value=t,ye.querySelector("var").textContent=`${t.toFixed(0)}%`,t===100&&setTimeout(()=>ye.open=!1,1e3)})(e,Y.length)}}),ge={dialog:j("dialog#help"),select(e){return j(`dialog#help ${e}`)},use(e=!0,t=0){ge.dialog.open=e;const{title:r,description:n}=vn[t-1]??{};r&&(ge.select("span").innerText=r),n&&(ge.select("p").innerText=n)}};window.helper=ge;const p={codecPreferences:j("select#codecPreferences"),playIcon:j("button#play svg use"),twinPhoton:j("input#twinPhoton"),source:j("select#sourceStream"),recording:j("video#recording"),recorded:j("video#recorded"),record:j("button#record"),download:j("a#download"),start:j("button#start"),convert:j("a#convert"),play:j("button#play")};document.head.querySelectorAll("meta").forEach(e=>{e.httpEquiv});const Ot=hn(j("output#errorMsg")),Me=j("details"),G={start:async()=>{p.start.disabled=!0;const e={audio:{echoCancellation:{exact:!0}},video:{width:1280,height:720}},{source:t}=k.value();try{if(t==="display"){const r=await yn(e);qe(r),be=r}else{const r=await wn(e);qe(r),be=r}}catch(r){Ot(r,"Erro ao solicitar fluxo do usuário")}},record(e){p.record.textContent==="Comece a gravar"?(Sn(e),p.recording.hidden=!1,p.recorded.hidden=!0):(G.stop(),p.record.textContent="Comece a gravar",k.value().iAmZombie||(p.play.disabled=!1,Ue(Me,!1),p.recording.hidden=!1,p.codecPreferences.disabled=!1),p.recorded.hidden=!0)},stop(){V.stop()},play(){if(p.recorded.currentTime===0){const[e]=k.value().codecPreferences,t=new Blob(Y,{type:e});p.recorded.src="",p.recorded.srcObject=null,p.recorded.src=URL.createObjectURL(t),p.recorded.controls=!1,p.recording.hidden=!0,p.recorded.hidden=!1}p.recorded.paused?(p.recorded.play(),p.playIcon.setAttribute("href","#icon-pause")):(p.recorded.pause(),p.playIcon.setAttribute("href","#icon-play"))},download(){const e=new Blob(Y,{type:"video/webm"});Ve(e,"video.webm")},convert:async()=>{ye.open=!0;const e=new Blob(Y,{type:"video/webm"});fe.isLoaded()||await fe.load(),fe.FS("writeFile","video.webm",await Ke.fetchFile(e)),await fe.run("-i","video.webm","-c:v","libx264","video.mp4");const t=fe.FS("readFile","video.mp4");Ve(new Blob([t.buffer],{type:"video/mp4"}),"video.webm","video.mp4")},twinPhoton(){const{twinPhoton:e}=k.value();e||k.setState({twinPhoton:!0})}};p.codecPreferences.onchange=()=>{const{value:e}=p.codecPreferences;k.setState({codecPreferences:e})};p.start.onclick=()=>{k.setState({source:p.source.value}),G.start(),p.twinPhoton.checked&&D.send({type:"start"})};p.record.onclick=()=>{const{value:e}=p.codecPreferences,t=e.split(";").shift()??"";G.record(t),p.twinPhoton.checked&&D.send({type:"record",message:t})};p.play.onclick=()=>{G.play(),p.twinPhoton.checked&&D.send({type:"play"})};p.download.onclick=()=>{G.download(),p.twinPhoton.checked&&D.send({type:"download"})};p.convert.onclick=()=>{G.convert(),p.twinPhoton.checked&&D.send({type:"convert"})};p.twinPhoton.onchange=()=>{D.send({type:"rachow"}),k.setState({source:"display"}),p.source.value="display",p.source.disabled=!0};tn([B(p.codecPreferences,"change"),B(p.start,"click"),B(p.record,"click"),B(p.play,"click"),B(p.download,"click"),B(p.convert,"click"),B(p.twinPhoton,"click")]);B(p.start,"click").pipe(mn(PointerEvent),Ee(e=>e));function Sn(e){Y=[];try{V=new MediaRecorder(be,{mimeType:e})}catch(t){Ot(t,"Exceção ao criar o gravador de mídia");return}console.log("Gravador de mídia criado",V,"with options",{mimeType:e}),p.record.textContent="Pare de gravar",p.codecPreferences.disabled=!0,p.source.disabled=!0,p.play.disabled=!0,Ue(Me,!0),V.onstop=()=>{console.log("Gravador de mídia criado: ",event),console.log("Blobs Gravados: ",Y)},V.ondataavailable=En,V.start(1e3),console.log("Gravador de mídia iniciado",V)}function qe(e){p.source.disabled=!0,p.start.disabled=!0,console.log("Fluxo de mídia do usuário recebido:",e),be=e,p.recording.srcObject=e,Ye().forEach(t=>{p.codecPreferences.add(new Option(t,t))}),k.value().iAmZombie||(p.record.disabled=!1,p.codecPreferences.disabled=!1)}function En(e){console.log("Dados armazenados",e.data),e.data&&e.data.size>0&&Y.push(e.data)}const D=new gn(crypto.randomUUID());D.on=e=>{const{iAmZombie:t}=k.value();switch(e.type){case"offer":{k.value().hasOffer||(console.log("recebi oferta e enviei uma resposta"),k.setState({hasOffer:!0}),D.send({type:"answer"}));return}case"answer":{k.value().hasAnswer||(console.log("recebi uma resposta"),k.setState({hasAnswer:!0}),D.send({type:"answer"}));return}case"rachow":{console.log("eu sou um zumbi"),p.source.disabled=!0,p.start.disabled=!0,p.codecPreferences.disabled=!0,p.record.disabled=!0,p.play.disabled=!0,Ue(Me,!0);const r=Ye().shift();return document.body.classList.add("zombie"),k.setState({iAmZombie:!0,codecPreferences:r,source:"user"})}case"start":if(t)return G.start();case"play":if(t)return G.play();case"record":if(console.log(e.message),t)return G.record(e.message);case"stop":if(t)return G.stop();case"download":if(t)return G.download();case"convert":if(t)return G.convert()}};k.select(e=>e).subscribe(e=>{console.log(e);const{hasOffer:t,hasAnswer:r}=e;t&&r&&(p.twinPhoton.disabled=!1)});console.log("enviei uma oferta");D.send({type:"offer"});
