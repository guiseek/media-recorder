(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();function Ze(e){const r=document.createElement("meta");r.httpEquiv="origin-trial",r.content=e,document.head.appendChild(r)}function Qe(){return["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=h264,opus","video/mp4;codecs=h264,aac"].filter(r=>MediaRecorder.isTypeSupported(r))}function Xe(e){if(e.__esModule)return e;var r=e.default;if(typeof r=="function"){var t=function o(){if(this instanceof o){var i=[null];i.push.apply(i,arguments);var n=Function.bind.apply(r,i);return new n}return r.apply(this,arguments)};t.prototype=r.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(o){var i=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,i.get?i:{enumerable:!0,get:function(){return e[o]}})}),t}var Le={},er={get exports(){return Le},set exports(e){Le=e}};(function(e){var r=function(t){var o=Object.prototype,i=o.hasOwnProperty,n=Object.defineProperty||function(c,a,u){c[a]=u.value},s,d=typeof Symbol=="function"?Symbol:{},l=d.iterator||"@@iterator",f=d.asyncIterator||"@@asyncIterator",v=d.toStringTag||"@@toStringTag";function b(c,a,u){return Object.defineProperty(c,a,{value:u,enumerable:!0,configurable:!0,writable:!0}),c[a]}try{b({},"")}catch{b=function(a,u,y){return a[u]=y}}function g(c,a,u,y){var p=a&&a.prototype instanceof W?a:W,w=Object.create(p.prototype),k=new O(y||[]);return n(w,"_invoke",{value:ue(c,u,k)}),w}t.wrap=g;function E(c,a,u){try{return{type:"normal",arg:c.call(a,u)}}catch(y){return{type:"throw",arg:y}}}var T="suspendedStart",S="suspendedYield",U="executing",C="completed",F={};function W(){}function Y(){}function $(){}var Q={};b(Q,l,function(){return this});var X=Object.getPrototypeOf,J=X&&X(X(j([])));J&&J!==o&&i.call(J,l)&&(Q=J);var M=$.prototype=W.prototype=Object.create(Q);Y.prototype=$,n(M,"constructor",{value:$,configurable:!0}),n($,"constructor",{value:Y,configurable:!0}),Y.displayName=b($,v,"GeneratorFunction");function oe(c){["next","throw","return"].forEach(function(a){b(c,a,function(u){return this._invoke(a,u)})})}t.isGeneratorFunction=function(c){var a=typeof c=="function"&&c.constructor;return a?a===Y||(a.displayName||a.name)==="GeneratorFunction":!1},t.mark=function(c){return Object.setPrototypeOf?Object.setPrototypeOf(c,$):(c.__proto__=$,b(c,v,"GeneratorFunction")),c.prototype=Object.create(M),c},t.awrap=function(c){return{__await:c}};function z(c,a){function u(w,k,A,I){var R=E(c[w],c,k);if(R.type==="throw")I(R.arg);else{var le=R.arg,ee=le.value;return ee&&typeof ee=="object"&&i.call(ee,"__await")?a.resolve(ee.__await).then(function(G){u("next",G,A,I)},function(G){u("throw",G,A,I)}):a.resolve(ee).then(function(G){le.value=G,A(le)},function(G){return u("throw",G,A,I)})}}var y;function p(w,k){function A(){return new a(function(I,R){u(w,k,I,R)})}return y=y?y.then(A,A):A()}n(this,"_invoke",{value:p})}oe(z.prototype),b(z.prototype,f,function(){return this}),t.AsyncIterator=z,t.async=function(c,a,u,y,p){p===void 0&&(p=Promise);var w=new z(g(c,a,u,y),p);return t.isGeneratorFunction(a)?w:w.next().then(function(k){return k.done?k.value:w.next()})};function ue(c,a,u){var y=T;return function(w,k){if(y===U)throw new Error("Generator is already running");if(y===C){if(w==="throw")throw k;return _()}for(u.method=w,u.arg=k;;){var A=u.delegate;if(A){var I=ie(A,u);if(I){if(I===F)continue;return I}}if(u.method==="next")u.sent=u._sent=u.arg;else if(u.method==="throw"){if(y===T)throw y=C,u.arg;u.dispatchException(u.arg)}else u.method==="return"&&u.abrupt("return",u.arg);y=U;var R=E(c,a,u);if(R.type==="normal"){if(y=u.done?C:S,R.arg===F)continue;return{value:R.arg,done:u.done}}else R.type==="throw"&&(y=C,u.method="throw",u.arg=R.arg)}}}function ie(c,a){var u=a.method,y=c.iterator[u];if(y===s)return a.delegate=null,u==="throw"&&c.iterator.return&&(a.method="return",a.arg=s,ie(c,a),a.method==="throw")||u!=="return"&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+u+"' method")),F;var p=E(y,c.iterator,a.arg);if(p.type==="throw")return a.method="throw",a.arg=p.arg,a.delegate=null,F;var w=p.arg;if(!w)return a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,F;if(w.done)a[c.resultName]=w.value,a.next=c.nextLoc,a.method!=="return"&&(a.method="next",a.arg=s);else return w;return a.delegate=null,F}oe(M),b(M,v,"Generator"),b(M,l,function(){return this}),b(M,"toString",function(){return"[object Generator]"});function m(c){var a={tryLoc:c[0]};1 in c&&(a.catchLoc=c[1]),2 in c&&(a.finallyLoc=c[2],a.afterLoc=c[3]),this.tryEntries.push(a)}function L(c){var a=c.completion||{};a.type="normal",delete a.arg,c.completion=a}function O(c){this.tryEntries=[{tryLoc:"root"}],c.forEach(m,this),this.reset(!0)}t.keys=function(c){var a=Object(c),u=[];for(var y in a)u.push(y);return u.reverse(),function p(){for(;u.length;){var w=u.pop();if(w in a)return p.value=w,p.done=!1,p}return p.done=!0,p}};function j(c){if(c){var a=c[l];if(a)return a.call(c);if(typeof c.next=="function")return c;if(!isNaN(c.length)){var u=-1,y=function p(){for(;++u<c.length;)if(i.call(c,u))return p.value=c[u],p.done=!1,p;return p.value=s,p.done=!0,p};return y.next=y}}return{next:_}}t.values=j;function _(){return{value:s,done:!0}}return O.prototype={constructor:O,reset:function(c){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(L),!c)for(var a in this)a.charAt(0)==="t"&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=s)},stop:function(){this.done=!0;var c=this.tryEntries[0],a=c.completion;if(a.type==="throw")throw a.arg;return this.rval},dispatchException:function(c){if(this.done)throw c;var a=this;function u(I,R){return w.type="throw",w.arg=c,a.next=I,R&&(a.method="next",a.arg=s),!!R}for(var y=this.tryEntries.length-1;y>=0;--y){var p=this.tryEntries[y],w=p.completion;if(p.tryLoc==="root")return u("end");if(p.tryLoc<=this.prev){var k=i.call(p,"catchLoc"),A=i.call(p,"finallyLoc");if(k&&A){if(this.prev<p.catchLoc)return u(p.catchLoc,!0);if(this.prev<p.finallyLoc)return u(p.finallyLoc)}else if(k){if(this.prev<p.catchLoc)return u(p.catchLoc,!0)}else if(A){if(this.prev<p.finallyLoc)return u(p.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(c,a){for(var u=this.tryEntries.length-1;u>=0;--u){var y=this.tryEntries[u];if(y.tryLoc<=this.prev&&i.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var p=y;break}}p&&(c==="break"||c==="continue")&&p.tryLoc<=a&&a<=p.finallyLoc&&(p=null);var w=p?p.completion:{};return w.type=c,w.arg=a,p?(this.method="next",this.next=p.finallyLoc,F):this.complete(w)},complete:function(c,a){if(c.type==="throw")throw c.arg;return c.type==="break"||c.type==="continue"?this.next=c.arg:c.type==="return"?(this.rval=this.arg=c.arg,this.method="return",this.next="end"):c.type==="normal"&&a&&(this.next=a),F},finish:function(c){for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a];if(u.finallyLoc===c)return this.complete(u.completion,u.afterLoc),L(u),F}},catch:function(c){for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a];if(u.tryLoc===c){var y=u.completion;if(y.type==="throw"){var p=y.arg;L(u)}return p}}throw new Error("illegal catch attempt")},delegateYield:function(c,a,u){return this.delegate={iterator:j(c),resultName:a,nextLoc:u},this.method==="next"&&(this.arg=s),F}},t}(e.exports);try{regeneratorRuntime=r}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}})(er);var rr={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}},tr=(e,r)=>{const t=e._malloc(r.length*Uint32Array.BYTES_PER_ELEMENT);return r.forEach((o,i)=>{const n=e.lengthBytesUTF8(o)+1,s=e._malloc(n);e.stringToUTF8(o,s,n),e.setValue(t+Uint32Array.BYTES_PER_ELEMENT*i,s,"i32")}),[r.length,t]};const nr="@ffmpeg/ffmpeg",or="0.11.6",ir="FFmpeg WebAssembly version",ar="src/index.js",sr="src/index.d.ts",cr={example:"examples"},ur={start:"node scripts/server.js","start:worker":"node scripts/worker-server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js","build:worker":"rimraf dist && webpack --config scripts/webpack.config.worker.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node node_modules/mocha/bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},lr={"./src/node/index.js":"./src/browser/index.js"},fr={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},dr=["ffmpeg","WebAssembly","video"],pr="Jerome Wu <jeromewus@gmail.com>",hr="MIT",mr={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},yr={node:">=12.16.1"},vr="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",gr={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},br={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.11.0","@types/emscripten":"^1.39.4","babel-eslint":"^10.1.0","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"},wr="https://registry.npmjs.org/@ffmpeg/ffmpeg/-/ffmpeg-0.11.6.tgz",Er="sha512-uN8J8KDjADEavPhNva6tYO9Fj0lWs9z82swF3YXnTxWMBoFLGq3LZ6FLlIldRKEzhOBKnkVfA8UnFJuvGvNxcA==",Sr="@ffmpeg/ffmpeg@0.11.6",xe={name:nr,version:or,description:ir,main:ar,types:sr,directories:cr,scripts:ur,browser:lr,repository:fr,keywords:dr,author:pr,license:hr,bugs:mr,engines:yr,homepage:vr,dependencies:gr,devDependencies:br,_resolved:wr,_integrity:Er,_from:Sr},Fr=(typeof process<"u",`https://unpkg.com/@ffmpeg/core@${xe.devDependencies["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`),Lr={corePath:Fr};let ve=!1,Ce=()=>{};const Or=e=>{ve=e},Pr=e=>{Ce=e},jr=(e,r)=>{Ce({type:e,message:r}),ve&&console.log(`[${e}] ${r}`)};var B={logging:ve,setLogging:Or,setCustomLogger:Pr,log:jr};const Tr=e=>`
createFFmpegCore is not defined. ffmpeg.wasm is unable to find createFFmpegCore after loading ffmpeg-core.js from ${e}. Use another URL when calling createFFmpeg():

const ffmpeg = createFFmpeg({
  corePath: 'http://localhost:3000/ffmpeg-core.js',
});
`;var Oe={CREATE_FFMPEG_CORE_IS_NOT_DEFINED:Tr};const H=async(e,r)=>{B.log("info",`fetch ${e}`);const t=await(await fetch(e)).arrayBuffer();B.log("info",`${e} file size = ${t.byteLength} bytes`);const o=new Blob([t],{type:r}),i=URL.createObjectURL(o);return B.log("info",`${e} blob URL = ${i}`),i},_r=async({corePath:e,workerPath:r,wasmPath:t})=>{if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){if(typeof e!="string")throw Error("corePath should be a string!");const d=new URL(e,import.meta.url).href,l=await H(d,"application/javascript"),f=await H(t!==void 0?t:d.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),v=await H(r!==void 0?r:d.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(b=>{if(globalThis.importScripts(l),typeof createFFmpegCore>"u")throw Error(Oe.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(d));B.log("info","ffmpeg-core.js script loaded"),b({createFFmpegCore,corePath:l,wasmPath:f,workerPath:v})}):(B.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:l,wasmPath:f,workerPath:v}))}if(typeof e!="string")throw Error("corePath should be a string!");const o=new URL(e,import.meta.url).href,i=await H(o,"application/javascript"),n=await H(t!==void 0?t:o.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),s=await H(r!==void 0?r:o.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(d=>{const l=document.createElement("script"),f=()=>{if(l.removeEventListener("load",f),typeof createFFmpegCore>"u")throw Error(Oe.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(o));B.log("info","ffmpeg-core.js script loaded"),d({createFFmpegCore,corePath:i,wasmPath:n,workerPath:s})};l.src=i,l.type="text/javascript",l.addEventListener("load",f),document.getElementsByTagName("head")[0].appendChild(l)}):(B.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:i,wasmPath:n,workerPath:s}))},kr=e=>new Promise((r,t)=>{const o=new FileReader;o.onload=()=>{r(o.result)},o.onerror=({target:{error:{code:i}}})=>{t(Error(`File could not be read! Code=${i}`))},o.readAsArrayBuffer(e)}),Ar=async e=>{let r=e;return typeof e>"u"?new Uint8Array:(typeof e=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?r=atob(e.split(",")[1]).split("").map(t=>t.charCodeAt(0)):r=await(await fetch(new URL(e,import.meta.url).href)).arrayBuffer():(e instanceof File||e instanceof Blob)&&(r=await kr(e)),new Uint8Array(r))},Rr=Object.freeze(Object.defineProperty({__proto__:null,defaultOptions:Lr,fetchFile:Ar,getCreateFFmpegCore:_r},Symbol.toStringTag,{value:"Module"})),Ie=Xe(Rr),{defaultArgs:xr,baseOptions:Cr}=rr,Ir=tr,{defaultOptions:Ur,getCreateFFmpegCore:$r}=Ie,{version:Mr}=xe,fe=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var Gr=(e={})=>{const{log:r,logger:t,progress:o,...i}={...Cr,...Ur,...e};let n=null,s=null,d=null,l=null,f=!1,v=()=>{},b=r,g=o,E=0,T=0,S=!1,U=0;const C=m=>{m==="FFMPEG_END"&&d!==null&&(d(),d=null,l=null,f=!1)},F=(m,L)=>{v({type:m,message:L}),b&&console.log(`[${m}] ${L}`)},W=m=>{const[L,O,j]=m.split(":");return parseFloat(L)*60*60+parseFloat(O)*60+parseFloat(j)},Y=(m,L)=>{if(typeof m=="string")if(m.startsWith("  Duration")){const O=m.split(", ")[0].split(": ")[1],j=W(O);L({duration:j,ratio:U}),(E===0||E>j)&&(E=j,S=!0)}else if(S&&m.startsWith("    Stream")){const O=m.match(/([\d.]+) fps/);if(O){const j=parseFloat(O[1]);T=E*j}else T=0;S=!1}else if(m.startsWith("frame")||m.startsWith("size")){const O=m.split("time=")[1].split(" ")[0],j=W(O),_=m.match(/frame=\s*(\d+)/);if(T&&_){const c=parseFloat(_[1]);U=Math.min(c/T,1)}else U=j/E;L({ratio:U,time:j})}else m.startsWith("video:")&&(L({ratio:1}),E=0)},$=({type:m,message:L})=>{F(m,L),Y(L,g),C(L)},Q=async()=>{if(F("info","load ffmpeg-core"),n===null){F("info","loading ffmpeg-core");const{createFFmpegCore:m,corePath:L,workerPath:O,wasmPath:j}=await $r(i);n=await m({mainScriptUrlOrBlob:L,printErr:_=>$({type:"fferr",message:_}),print:_=>$({type:"ffout",message:_}),locateFile:(_,c)=>{if(typeof window<"u"||typeof WorkerGlobalScope<"u"){if(typeof j<"u"&&_.endsWith("ffmpeg-core.wasm"))return j;if(typeof O<"u"&&_.endsWith("ffmpeg-core.worker.js"))return O}return c+_}}),s=n.cwrap(i.mainName||"proxy_main","number",["number","number"]),F("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},X=()=>n!==null,J=(...m)=>{if(F("info",`run ffmpeg command: ${m.join(" ")}`),n===null)throw fe;if(f)throw Error("ffmpeg.wasm can only run one command at a time");return f=!0,new Promise((L,O)=>{const j=[...xr,...m].filter(_=>_.length!==0);d=L,l=O,s(...Ir(n,j))})},M=(m,...L)=>{if(F("info",`run FS.${m} ${L.map(O=>typeof O=="string"?O:`<${O.length} bytes binary file>`).join(" ")}`),n===null)throw fe;{let O=null;try{O=n.FS[m](...L)}catch{throw Error(m==="readdir"?`ffmpeg.FS('readdir', '${L[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:m==="readFile"?`ffmpeg.FS('readFile', '${L[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return O}},oe=()=>{if(n===null)throw fe;l&&l("ffmpeg has exited"),f=!1;try{n.exit(1)}catch(m){F(m.message),l&&l(m)}finally{n=null,s=null,d=null,l=null}},z=m=>{g=m},ue=m=>{v=m},ie=m=>{b=m};return F("info",`use ffmpeg.wasm v${Mr}`),{setProgress:z,setLogger:ue,setLogging:ie,load:Q,isLoaded:X,run:J,exit:oe,FS:M}};const Dr=Gr,{fetchFile:Br}=Ie;var Ue={createFFmpeg:Dr,fetchFile:Br};const Nr=e=>({time:r,ratio:t},o)=>{let i=0,n=0;r&&(n=100*r/o),t===1&&(n=100),n>i&&e(n),i=n},$e=(e,r)=>{e.querySelector("summary").ariaDisabled=JSON.stringify(r),e.querySelector("a#download").ariaDisabled=JSON.stringify(r),e.querySelector("a#convert").ariaDisabled=JSON.stringify(r)},qr=e=>(r,t="")=>{console.error(r),e.innerHTML=t?`${t}: `:""+JSON.stringify(r)},Wr=e=>navigator.mediaDevices.getDisplayMedia({...e,audio:!0});var he=function(e,r){return he=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])},he(e,r)};function ge(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");he(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}function Yr(e,r,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function d(v){try{f(o.next(v))}catch(b){s(b)}}function l(v){try{f(o.throw(v))}catch(b){s(b)}}function f(v){v.done?n(v.value):i(v.value).then(d,l)}f((o=o.apply(e,r||[])).next())})}function Me(e,r){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,i,n,s;return s={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function d(f){return function(v){return l([f,v])}}function l(f){if(o)throw new TypeError("Generator is already executing.");for(;s&&(s=0,f[0]&&(t=0)),t;)try{if(o=1,i&&(n=f[0]&2?i.return:f[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,f[1])).done)return n;switch(i=0,n&&(f=[f[0]&2,n.value]),f[0]){case 0:case 1:n=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,i=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!n||f[1]>n[0]&&f[1]<n[3])){t.label=f[1];break}if(f[0]===6&&t.label<n[1]){t.label=n[1],n=f;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(f);break}n[2]&&t.ops.pop(),t.trys.pop();continue}f=r.call(e,t)}catch(v){f=[6,v],i=0}finally{o=n=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function te(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],o=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function V(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var o=t.call(e),i,n=[],s;try{for(;(r===void 0||r-- >0)&&!(i=o.next()).done;)n.push(i.value)}catch(d){s={error:d}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(s)throw s.error}}return n}function ne(e,r,t){if(t||arguments.length===2)for(var o=0,i=r.length,n;o<i;o++)(n||!(o in r))&&(n||(n=Array.prototype.slice.call(r,0,o)),n[o]=r[o]);return e.concat(n||Array.prototype.slice.call(r))}function K(e){return this instanceof K?(this.v=e,this):new K(e)}function Jr(e,r,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=t.apply(e,r||[]),i,n=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(g){o[g]&&(i[g]=function(E){return new Promise(function(T,S){n.push([g,E,T,S])>1||d(g,E)})})}function d(g,E){try{l(o[g](E))}catch(T){b(n[0][3],T)}}function l(g){g.value instanceof K?Promise.resolve(g.value.v).then(f,v):b(n[0][2],g)}function f(g){d("next",g)}function v(g){d("throw",g)}function b(g,E){g(E),n.shift(),n.length&&d(n[0][0],n[0][1])}}function zr(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof te=="function"?te(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(s){return new Promise(function(d,l){s=e[n](s),i(d,l,s.done,s.value)})}}function i(n,s,d,l){Promise.resolve(l).then(function(f){n({value:f,done:d})},s)}}function P(e){return typeof e=="function"}function Hr(e){var r=function(o){Error.call(o),o.stack=new Error().stack},t=e(r);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var de=Hr(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(o,i){return i+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function Pe(e,r){if(e){var t=e.indexOf(r);0<=t&&e.splice(t,1)}}var be=function(){function e(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var r,t,o,i,n;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var d=te(s),l=d.next();!l.done;l=d.next()){var f=l.value;f.remove(this)}}catch(S){r={error:S}}finally{try{l&&!l.done&&(t=d.return)&&t.call(d)}finally{if(r)throw r.error}}else s.remove(this);var v=this.initialTeardown;if(P(v))try{v()}catch(S){n=S instanceof de?S.errors:[S]}var b=this._finalizers;if(b){this._finalizers=null;try{for(var g=te(b),E=g.next();!E.done;E=g.next()){var T=E.value;try{je(T)}catch(S){n=n??[],S instanceof de?n=ne(ne([],V(n)),V(S.errors)):n.push(S)}}}catch(S){o={error:S}}finally{try{E&&!E.done&&(i=g.return)&&i.call(g)}finally{if(o)throw o.error}}}if(n)throw new de(n)}},e.prototype.add=function(r){var t;if(r&&r!==this)if(this.closed)je(r);else{if(r instanceof e){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(r)}},e.prototype._hasParent=function(r){var t=this._parentage;return t===r||Array.isArray(t)&&t.includes(r)},e.prototype._addParent=function(r){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(r),t):t?[t,r]:r},e.prototype._removeParent=function(r){var t=this._parentage;t===r?this._parentage=null:Array.isArray(t)&&Pe(t,r)},e.prototype.remove=function(r){var t=this._finalizers;t&&Pe(t,r),r instanceof e&&r._removeParent(this)},e.EMPTY=function(){var r=new e;return r.closed=!0,r}(),e}();be.EMPTY;function Ge(e){return e instanceof be||e&&"closed"in e&&P(e.remove)&&P(e.add)&&P(e.unsubscribe)}function je(e){P(e)?e():e.unsubscribe()}var De={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},me={setTimeout:function(e,r){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];var i=me.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,ne([e,r],V(t))):setTimeout.apply(void 0,ne([e,r],V(t)))},clearTimeout:function(e){var r=me.delegate;return((r==null?void 0:r.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Be(e){me.setTimeout(function(){throw e})}function Te(){}function Kr(e){e()}var we=function(e){ge(r,e);function r(t){var o=e.call(this)||this;return o.isStopped=!1,t?(o.destination=t,Ge(t)&&t.add(o)):o.destination=Xr,o}return r.create=function(t,o,i){return new ye(t,o,i)},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(be),Vr=Function.prototype.bind;function pe(e,r){return Vr.call(e,r)}var Zr=function(){function e(r){this.partialObserver=r}return e.prototype.next=function(r){var t=this.partialObserver;if(t.next)try{t.next(r)}catch(o){ae(o)}},e.prototype.error=function(r){var t=this.partialObserver;if(t.error)try{t.error(r)}catch(o){ae(o)}else ae(r)},e.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(t){ae(t)}},e}(),ye=function(e){ge(r,e);function r(t,o,i){var n=e.call(this)||this,s;if(P(t)||!t)s={next:t??void 0,error:o??void 0,complete:i??void 0};else{var d;n&&De.useDeprecatedNextContext?(d=Object.create(t),d.unsubscribe=function(){return n.unsubscribe()},s={next:t.next&&pe(t.next,d),error:t.error&&pe(t.error,d),complete:t.complete&&pe(t.complete,d)}):s=t}return n.destination=new Zr(s),n}return r}(we);function ae(e){Be(e)}function Qr(e){throw e}var Xr={closed:!0,next:Te,error:Qr,complete:Te},Ee=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function et(e){return e}function rt(e){return e.length===0?et:e.length===1?e[0]:function(t){return e.reduce(function(o,i){return i(o)},t)}}var q=function(){function e(r){r&&(this._subscribe=r)}return e.prototype.lift=function(r){var t=new e;return t.source=this,t.operator=r,t},e.prototype.subscribe=function(r,t,o){var i=this,n=nt(r)?r:new ye(r,t,o);return Kr(function(){var s=i,d=s.operator,l=s.source;n.add(d?d.call(n,l):l?i._subscribe(n):i._trySubscribe(n))}),n},e.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(t){r.error(t)}},e.prototype.forEach=function(r,t){var o=this;return t=_e(t),new t(function(i,n){var s=new ye({next:function(d){try{r(d)}catch(l){n(l),s.unsubscribe()}},error:n,complete:i});o.subscribe(s)})},e.prototype._subscribe=function(r){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(r)},e.prototype[Ee]=function(){return this},e.prototype.pipe=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return rt(r)(this)},e.prototype.toPromise=function(r){var t=this;return r=_e(r),new r(function(o,i){var n;t.subscribe(function(s){return n=s},function(s){return i(s)},function(){return o(n)})})},e.create=function(r){return new e(r)},e}();function _e(e){var r;return(r=e??De.Promise)!==null&&r!==void 0?r:Promise}function tt(e){return e&&P(e.next)&&P(e.error)&&P(e.complete)}function nt(e){return e&&e instanceof we||tt(e)&&Ge(e)}function ot(e){return P(e==null?void 0:e.lift)}function Se(e){return function(r){if(ot(r))return r.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function ce(e,r,t,o,i){return new it(e,r,t,o,i)}var it=function(e){ge(r,e);function r(t,o,i,n,s,d){var l=e.call(this,t)||this;return l.onFinalize=s,l.shouldUnsubscribe=d,l._next=o?function(f){try{o(f)}catch(v){t.error(v)}}:e.prototype._next,l._error=n?function(f){try{n(f)}catch(v){t.error(v)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=i?function(){try{i()}catch(f){t.error(f)}finally{this.unsubscribe()}}:e.prototype._complete,l}return r.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;e.prototype.unsubscribe.call(this),!o&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},r}(we),Ne=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function at(e){return P(e==null?void 0:e.then)}function st(e){return P(e[Ee])}function ct(e){return Symbol.asyncIterator&&P(e==null?void 0:e[Symbol.asyncIterator])}function ut(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function lt(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ft=lt();function dt(e){return P(e==null?void 0:e[ft])}function pt(e){return Jr(this,arguments,function(){var t,o,i,n;return Me(this,function(s){switch(s.label){case 0:t=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,K(t.read())];case 3:return o=s.sent(),i=o.value,n=o.done,n?[4,K(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,K(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function ht(e){return P(e==null?void 0:e.getReader)}function Fe(e){if(e instanceof q)return e;if(e!=null){if(st(e))return mt(e);if(Ne(e))return yt(e);if(at(e))return vt(e);if(ct(e))return qe(e);if(dt(e))return gt(e);if(ht(e))return bt(e)}throw ut(e)}function mt(e){return new q(function(r){var t=e[Ee]();if(P(t.subscribe))return t.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function yt(e){return new q(function(r){for(var t=0;t<e.length&&!r.closed;t++)r.next(e[t]);r.complete()})}function vt(e){return new q(function(r){e.then(function(t){r.closed||(r.next(t),r.complete())},function(t){return r.error(t)}).then(null,Be)})}function gt(e){return new q(function(r){var t,o;try{for(var i=te(e),n=i.next();!n.done;n=i.next()){var s=n.value;if(r.next(s),r.closed)return}}catch(d){t={error:d}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}r.complete()})}function qe(e){return new q(function(r){wt(e,r).catch(function(t){return r.error(t)})})}function bt(e){return qe(pt(e))}function wt(e,r){var t,o,i,n;return Yr(this,void 0,void 0,function(){var s,d;return Me(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),t=zr(e),l.label=1;case 1:return[4,t.next()];case 2:if(o=l.sent(),!!o.done)return[3,4];if(s=o.value,r.next(s),r.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return d=l.sent(),i={error:d},[3,11];case 6:return l.trys.push([6,,9,10]),o&&!o.done&&(n=t.return)?[4,n.call(t)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})}function Et(e,r,t,o,i){o===void 0&&(o=0),i===void 0&&(i=!1);var n=r.schedule(function(){t(),i?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(n),!i)return n}function We(e,r){return Se(function(t,o){var i=0;t.subscribe(ce(o,function(n){o.next(e.call(r,n,i++))}))})}var St=Array.isArray;function Ft(e,r){return St(r)?e.apply(void 0,ne([],V(r))):e(r)}function Lt(e){return We(function(r){return Ft(e,r)})}function Ot(e,r,t,o,i,n,s,d){var l=[],f=0,v=0,b=!1,g=function(){b&&!l.length&&!f&&r.complete()},E=function(S){return f<o?T(S):l.push(S)},T=function(S){n&&r.next(S),f++;var U=!1;Fe(t(S,v++)).subscribe(ce(r,function(C){i==null||i(C),n?E(C):r.next(C)},function(){U=!0},void 0,function(){if(U)try{f--;for(var C=function(){var F=l.shift();s?Et(r,s,function(){return T(F)}):T(F)};l.length&&f<o;)C();g()}catch(F){r.error(F)}}))};return e.subscribe(ce(r,E,function(){b=!0,g()})),function(){d==null||d()}}function Ye(e,r,t){return t===void 0&&(t=1/0),P(r)?Ye(function(o,i){return We(function(n,s){return r(o,n,i,s)})(Fe(e(o,i)))},t):(typeof r=="number"&&(t=r),Se(function(o,i){return Ot(o,i,e,t)}))}var Pt=["addListener","removeListener"],jt=["addEventListener","removeEventListener"],Tt=["on","off"];function Z(e,r,t,o){if(P(t)&&(o=t,t=void 0),o)return Z(e,r,t).pipe(Lt(o));var i=V(At(e)?jt.map(function(d){return function(l){return e[d](r,l,t)}}):_t(e)?Pt.map(ke(e,r)):kt(e)?Tt.map(ke(e,r)):[],2),n=i[0],s=i[1];if(!n&&Ne(e))return Ye(function(d){return Z(d,r,t)})(Fe(e));if(!n)throw new TypeError("Invalid event target");return new q(function(d){var l=function(){for(var f=[],v=0;v<arguments.length;v++)f[v]=arguments[v];return d.next(1<f.length?f:f[0])};return n(l),function(){return s(l)}})}function ke(e,r){return function(t){return function(o){return e[t](r,o)}}}function _t(e){return P(e.addListener)&&P(e.removeListener)}function kt(e){return P(e.on)&&P(e.off)}function At(e){return P(e.addEventListener)&&P(e.removeEventListener)}function Je(e,r){return Se(function(t,o){var i=0;t.subscribe(ce(o,function(n){return e.call(r,n,i++)&&o.next(n)}))})}const ze=(e,r,t)=>{const o=URL.createObjectURL(e),i=document.createElement("a");i.download=t||r,i.style.display="none",i.href=o,document.body.appendChild(i),i.click(),queueMicrotask(()=>{document.body.removeChild(i),URL.revokeObjectURL(o)})},Rt=e=>navigator.mediaDevices.getUserMedia(e),x=e=>document.querySelector(e);Ze({}.SHARED_ARRAY_BUFFER_TOKEN);let He,D,N=[];const se=x("dialog"),re=Ue.createFFmpeg({log:!1,progress:e=>{Nr(r=>{se.querySelector("progress").value=r,se.querySelector("var").textContent=`${r.toFixed(0)}%`,r===100&&setTimeout(()=>se.open=!1,1e3)})(e,N.length)}}),h={codecPreferences:x("select#codecPreferences"),playIcon:x("button#play svg use"),source:x("select#sourceStream"),recording:x("video#recording"),recorded:x("video#recorded"),record:x("button#record"),download:x("a#download"),start:x("button#start"),convert:x("a#convert"),play:x("button#play")},Ke=qr(x("output#errorMsg")),Ve=x("details");Z(h.record,"click").subscribe(()=>{h.record.textContent==="Comece a gravar"?(xt(),h.recording.hidden=!1,h.recorded.hidden=!0):(It(),h.record.textContent="Comece a gravar",h.play.disabled=!1,$e(Ve,!1),h.recording.hidden=!1,h.recorded.hidden=!0,h.codecPreferences.disabled=!1)});Z(h.play,"click").subscribe(()=>{if(h.recorded.currentTime===0){const[e]=h.codecPreferences.value.split(";",1),r=new Blob(N,{type:e});h.recorded.src="",h.recorded.srcObject=null,h.recorded.src=URL.createObjectURL(r),h.recorded.controls=!1,h.recording.hidden=!0,h.recorded.hidden=!1,console.log(h.recorded.currentTime)}h.recorded.paused?(h.recorded.play(),h.playIcon.setAttribute("href","#icon-pause")):(h.recorded.pause(),h.playIcon.setAttribute("href","#icon-play"))});function xt(){N=[];const e=h.codecPreferences.value;try{D=new MediaRecorder(He,{mimeType:e})}catch(r){Ke(r,"Exceção ao criar o gravador de mídia");return}console.log("Gravador de mídia criado",D,"with options",{mimeType:e}),h.record.textContent="Pare de gravar",h.codecPreferences.disabled=!0,h.source.disabled=!0,h.play.disabled=!0,$e(Ve,!0),D.onstop=r=>{console.log("Gravador de mídia criado: ",r),console.log("Blobs Gravados: ",N)},D.ondataavailable=Ct,D.start(1e3),console.log("Gravador de mídia iniciado",D)}function Ae(){h.record.disabled=!0,h.source.disabled=!1,h.start.disabled=!1}function Re(e){h.record.disabled=!1,h.source.disabled=!0,h.start.disabled=!0,console.log("Fluxo de mídia do usuário recebido:",e),He=e,h.recording.srcObject=e,Qe().forEach(r=>{h.codecPreferences.add(new Option(r,r))}),h.codecPreferences.disabled=!1}Z(h.download,"click").pipe(Je(()=>h.download.ariaDisabled==="false")).subscribe(()=>{const e=new Blob(N,{type:"video/webm"});ze(e,"test.webm")});Z(h.convert,"click").pipe(Je(()=>h.convert.ariaDisabled==="false")).subscribe(async()=>{se.open=!0;const e=new Blob(N,{type:"video/webm"});re.isLoaded()||await re.load(),re.FS("writeFile","test.webm",await Ue.fetchFile(e)),await re.run("-i","test.webm","test.mp4");const r=re.FS("readFile","test.mp4");ze(new Blob([r.buffer],{type:"video/mp4"}),"test.webm","test.mp4")});function Ct(e){console.log("Dados armazenados",e.data),e.data&&e.data.size>0&&N.push(e.data)}function It(){D.stop()}async function Ut(e){try{h.source.value==="display"?Wr(e).then(Re).catch(Ae):Rt(e).then(Re).catch(Ae)}catch(r){Ke(r,"Erro ao solicitar fluxo do usuário")}}h.start.onclick=async()=>{const e={audio:{echoCancellation:{exact:!0}},video:{width:1280,height:720}};console.log("Using media constraints:",e),await Ut(e)};
